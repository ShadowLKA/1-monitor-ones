<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Video Signage</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #000; color: white; overflow: hidden; }
        
        .video-container { width: 100vw; height: 100vh; position: relative; }
        .video-player { width: 100%; height: 100%; object-fit: cover; }
        
        .overlay { 
            position: absolute; bottom: 0; left: 0; right: 0; 
            background: linear-gradient(transparent, rgba(0,0,0,0.8)); 
            padding: 20px; transform: translateY(100%); transition: 0.3s; 
        }
        .video-container:hover .overlay { transform: translateY(0); }
        
        .config { 
            position: fixed; top: 10px; right: 10px; 
            background: rgba(0,0,0,0.9); padding: 15px; border-radius: 8px; 
            transform: translateX(100%); transition: 0.3s; z-index: 10;
        }
        .config.show { transform: translateX(0); }
        .config input { width: 200px; margin: 5px 0; padding: 8px; background: #333; border: none; color: white; border-radius: 4px; }
        .config button { background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin: 5px 0; }
        
        .toggle { position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.7); border: none; color: white; padding: 10px; border-radius: 50%; cursor: pointer; z-index: 20; }
        
        .loading { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            display: flex; align-items: center; justify-content: center; z-index: 100;
        }
        .loader { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-top: 5px solid white; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .status { position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); padding: 10px 15px; border-radius: 20px; font-size: 12px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div>
            <div class="loader"></div>
            <p style="margin-top: 20px;">Loading videos from GitHub...</p>
        </div>
    </div>

    <button class="toggle" onclick="toggleConfig()">⚙️</button>
    
    <div id="config" class="config">
        <h3>Configuration</h3>
        <input id="username" placeholder="GitHub Username" value="meama24252525">
        <input id="repo" placeholder="Repository Name">
        <input id="token" type="password" placeholder="GitHub Token">
        <input id="interval" type="number" placeholder="Switch Interval (seconds)" value="30">
        <button onclick="saveConfig()">Save & Start</button>
        <button onclick="refreshVideos()">Refresh Videos</button>
        <p style="font-size: 11px; margin-top: 10px; color: #ccc;">
            Videos will auto-rotate every X seconds
        </p>
    </div>

    <div id="videoContainer" class="video-container hidden">
        <video id="videoPlayer" class="video-player" muted autoplay></video>
        <div class="overlay">
            <h2 id="videoTitle">Loading...</h2>
            <p id="videoInfo">Preparing signage display</p>
        </div>
    </div>

    <div id="status" class="status">Ready to configure</div>

    <script>
        let config = { username: 'meama24252525', repo: '', token: '', interval: 30 };
        let videos = [];
        let currentIndex = 0;
        let intervalId = null;
        let isConfigVisible = false;

        // Load saved config
        const saved = localStorage.getItem('signage-config');
        if (saved) {
            config = { ...config, ...JSON.parse(saved) };
            document.getElementById('username').value = config.username;
            document.getElementById('repo').value = config.repo;
            document.getElementById('token').value = config.token;
            document.getElementById('interval').value = config.interval;
            
            if (config.repo && config.token) {
                autoStart();
            }
        }

        function toggleConfig() {
            isConfigVisible = !isConfigVisible;
            document.getElementById('config').classList.toggle('show', isConfigVisible);
        }

        function saveConfig() {
            config.username = document.getElementById('username').value.trim();
            config.repo = document.getElementById('repo').value.trim();
            config.token = document.getElementById('token').value.trim();
            config.interval = parseInt(document.getElementById('interval').value) || 30;
            
            if (!config.repo || !config.token) {
                updateStatus('Please fill in repository and token', 'error');
                return;
            }
            
            localStorage.setItem('signage-config', JSON.stringify(config));
            toggleConfig();
            startSignage();
        }

        async function startSignage() {
            document.getElementById('loading').classList.remove('hidden');
            updateStatus('Fetching videos from GitHub...');
            
            try {
                videos = await fetchVideos();
                if (videos.length === 0) {
                    throw new Error('No MP4 videos found in repository');
                }
                
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('videoContainer').classList.remove('hidden');
                
                playCurrentVideo();
                startRotation();
                updateStatus(`Playing ${videos.length} videos (${config.interval}s intervals)`);
            } catch (error) {
                updateStatus(`Error: ${error.message}`, 'error');
                document.getElementById('loading').classList.add('hidden');
            }
        }

        async function fetchVideos(path = '') {
            const url = `https://api.github.com/repos/${config.username}/${config.repo}/contents/${path}`;
            const response = await fetch(url, {
                headers: { 'Authorization': `token ${config.token}` }
            });
            
            if (!response.ok) throw new Error(`GitHub API error: ${response.status}`);
            
            const contents = await response.json();
            let foundVideos = [];
            
            for (const item of (Array.isArray(contents) ? contents : [contents])) {
                if (item.type === 'file' && item.name.toLowerCase().endsWith('.mp4')) {
                    foundVideos.push({
                        name: item.name,
                        url: item.download_url,
                        path: item.path,
                        size: item.size
                    });
                } else if (item.type === 'dir') {
                    const subVideos = await fetchVideos(item.path);
                    foundVideos = foundVideos.concat(subVideos);
                }
            }
            
            return foundVideos;
        }

        function playCurrentVideo() {
            if (videos.length === 0) return;
            
            const video = videos[currentIndex];
            const player = document.getElementById('videoPlayer');
            
            document.getElementById('videoTitle').textContent = video.name;
            document.getElementById('videoInfo').textContent = 
                `${currentIndex + 1} of ${videos.length} • ${(video.size / (1024*1024)).toFixed(1)}MB`;
            
            player.src = video.url;
            player.load();
            
            player.onloadeddata = () => player.play();
            player.onerror = () => {
                console.error('Video load error:', video.name);
                nextVideo();
            };
        }

        function nextVideo() {
            currentIndex = (currentIndex + 1) % videos.length;
            playCurrentVideo();
        }

        function startRotation() {
            clearInterval(intervalId);
            intervalId = setInterval(nextVideo, config.interval * 1000);
        }

        function refreshVideos() {
            if (config.repo && config.token) {
                startSignage();
            } else {
                updateStatus('Please configure first', 'error');
            }
        }

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.style.background = type === 'error' ? 'rgba(255,0,0,0.7)' : 'rgba(0,0,0,0.7)';
        }

        function autoStart() {
            setTimeout(() => {
                if (config.repo && config.token) {
                    startSignage();
                }
            }, 1000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextVideo();
            if (e.key === 'ArrowLeft') {
                currentIndex = currentIndex === 0 ? videos.length - 1 : currentIndex - 1;
                playCurrentVideo();
            }
            if (e.key === 'r') refreshVideos();
            if (e.key === 'c') toggleConfig();
        });

        // Auto-hide cursor after inactivity
        let hideTimeout;
        document.addEventListener('mousemove', () => {
            document.body.style.cursor = 'default';
            clearTimeout(hideTimeout);
            hideTimeout = setTimeout(() => {
                document.body.style.cursor = 'none';
            }, 3000);
        });
    </script>
</body>
</html>
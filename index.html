<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Display System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #f0f2f5; 
            padding: 20px; 
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .upload-btn, .refresh-btn {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: transform 0.2s;
        }
        
        .upload-btn:hover, .refresh-btn:hover {
            transform: translateY(-2px);
        }
        
        .refresh-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .delete-btn {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(255, 59, 48, 0.9);
            color: white;
            border: none;
            padding: 6px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            width: 28px;
            height: 28px;
            transition: background 0.2s;
        }
        
        .menu-card.selected {
            ring: 3px solid #007bff;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,123,255,0.3);
        }
        
        .upload-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .upload-btn:disabled:hover {
            transform: none;
        }
        
        .select-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,123,255,0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .menu-card.selected .select-indicator {
            opacity: 1;
        }
        
        .folder-section {
            margin-bottom: 30px;
        }
        
        .folder-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            padding: 10px 0;
            border-bottom: 2px solid #eee;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-size: 18px;
            padding: 60px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4a90e2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        
        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .fullscreen.show { display: flex; }
        
        .fullscreen video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            width: 50px;
            height: 50px;
        }
        
        .menu-card.selected {
            ring: 3px solid #007bff;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,123,255,0.3);
        }
        
        .upload-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .upload-btn:disabled:hover {
            transform: none;
        }
        
        .upload-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .upload-overlay.show { display: flex; }
        
        .upload-modal {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .upload-progress {
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #4a90e2, #357abd);
            width: 0%;
            transition: width 0.3s;
        }
        
        .folder-selector {
            margin: 15px 0;
        }
        
        .folder-selector select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
            max-width: 1400px;
        }
        
        .video-thumbnail {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            position: relative;
            overflow: hidden;
        }
        
        .video-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-content {
            padding: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .video-thumbnail:hover .video-overlay {
            opacity: 1;
        }
        
        .thumbnail-play-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #333;
        }
        
        .menu-card {
            background: #4a90e2;
            color: white;
            border-radius: 12px;
            padding: 0;
            text-align: center;
            position: relative;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .menu-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .menu-card.monitors-1 { 
            background: linear-gradient(135deg, #4a90e2, #357abd); 
        }
        .menu-card.monitors-2 { 
            background: linear-gradient(135deg, #7b68ee, #6a4fd8); 
        }
        
        .menu-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 10px;
            word-break: break-word;
        }
        
        .menu-info {
            font-size: 12px;
            opacity: 0.9;
            background: rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 15px;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .folder-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.3);
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }
        
        .play-icon {
            font-size: 24px;
            margin-top: 10px;
        }
        
        .folder-section {
            margin-bottom: 30px;
        }
        
        .folder-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            padding: 10px 0;
            border-bottom: 2px solid #eee;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-size: 18px;
            padding: 60px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4a90e2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        
        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .fullscreen.show { display: flex; }
        
        .fullscreen video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            width: 50px;
            height: 50px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">🍽️ Menu Display System</div>
        <div class="controls" style="margin: 15px 0; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
            <button class="upload-btn" id="uploadBtn" onclick="triggerFileUpload()" disabled>📤 Replace Selected</button>
            <input type="file" id="fileInput" accept=".mp4,.mov,.avi" style="display: none;" onchange="handleFileUpload(event)">
            <button class="refresh-btn" onclick="loadMenus()">🔄 Refresh</button>
            <button class="refresh-btn" onclick="toggleTokenInput()" style="background: #6c757d;">🔑 Token</button>
        </div>
        <div id="selectionInfo" style="text-align: center; margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; display: none;">
            <span id="selectedFileName">No file selected</span>
            <button onclick="clearSelection()" style="margin-left: 10px; background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px;">Clear</button>
        </div>
        <div id="tokenInput" style="display: none; margin: 10px 0;">
            <input type="password" id="githubToken" placeholder="GitHub Token (for private repos)" style="padding: 8px; width: 300px; border: 1px solid #ddd; border-radius: 4px;">
            <button onclick="saveToken()" style="padding: 8px 12px; margin-left: 5px; background: #28a745; color: white; border: none; border-radius: 4px;">Save</button>
        </div>
        <div class="status" id="status">Click on any video card to select it, then upload a replacement</div>
    </div>

    <div id="content" class="loading">
        <div class="spinner"></div>
        Loading your MP4 files... Click any card to select, then upload a replacement!
    </div>

    <div id="fullscreen" class="fullscreen">
        <video id="fullscreenVideo" controls autoplay></video>
        <button class="close-btn" onclick="closeVideo()">✕</button>
    </div>

    <div id="uploadOverlay" class="upload-overlay">
        <div class="upload-modal">
            <h3>📤 Replace Video File</h3>
            <div id="replaceInfo" style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <p><strong>Replacing:</strong> <span id="originalFileName"></span></p>
                <p><strong>Location:</strong> <span id="originalLocation"></span></p>
                <p><strong>New file:</strong> <span id="newFileName"></span></p>
            </div>
            <div id="uploadProgress" class="upload-progress" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="uploadStatus">Preparing upload...</p>
            </div>
            <div id="uploadButtons">
                <button class="upload-btn" onclick="startReplacement()">✅ Replace File</button>
                <button class="refresh-btn" onclick="closeUploadModal()" style="background: #6c757d;">❌ Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // CHANGE THIS: Replace 'your-repo-name' with your actual repository name
        const username = 'meama24252525';
        const repoName = '1-monitor-ones'; // ← Your repository name from the screenshot
        
        let menus1 = [];
        let menus2 = [];
        let selectedFiles = [];
        let githubToken = localStorage.getItem('github-token') || '';
        let selectedFile = null; // Track which file is selected for replacement

        // File selection functions
        function selectFile(filePath, fileName, folder) {
            // Clear previous selection
            document.querySelectorAll('.menu-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select new file
            const cardElement = document.getElementById(`card-${filePath}`);
            if (cardElement) {
                cardElement.classList.add('selected');
            }
            
            selectedFile = {
                path: filePath,
                name: fileName,
                folder: folder
            };
            
            // Update UI
            document.getElementById('selectedFileName').textContent = `Selected: ${fileName} (${folder})`;
            document.getElementById('selectionInfo').style.display = 'block';
            document.getElementById('uploadBtn').disabled = false;
        }

        function clearSelection() {
            document.querySelectorAll('.menu-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            selectedFile = null;
            document.getElementById('selectionInfo').style.display = 'none';
            document.getElementById('uploadBtn').disabled = true;
        }

        function triggerFileUpload() {
            if (!selectedFile) {
                alert('Please select a file to replace first');
                return;
            }
            document.getElementById('fileInput').click();
        }

        // Token management functions
        function toggleTokenInput() {
            const tokenDiv = document.getElementById('tokenInput');
            tokenDiv.style.display = tokenDiv.style.display === 'none' ? 'block' : 'none';
            if (tokenDiv.style.display === 'block') {
                document.getElementById('githubToken').value = githubToken;
            }
        }

        function saveToken() {
            githubToken = document.getElementById('githubToken').value.trim();
            localStorage.setItem('github-token', githubToken);
            document.getElementById('tokenInput').style.display = 'none';
            alert('Token saved! This will be used for uploads and deletes.');
        }

        function getHeaders() {
            const headers = {
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            };
            if (githubToken) {
                headers['Authorization'] = `token ${githubToken}`;
            }
            return headers;
        }

        async function loadMenus(repo = repoName) {
            
            document.getElementById('status').textContent = 'Scanning "1 monitors" and "2 monitors" folders...';
            document.getElementById('content').innerHTML = '<div class="loading"><div class="spinner"></div>Scanning for MP4 files...</div>';
            
            try {
                // Clear any previous selection when refreshing
                clearSelection();
                
                // Load menu files from both folders with correct names
                menus1 = await loadMenusFromFolder('1 monitors', repo);
                menus2 = await loadMenusFromFolder('2 monitors', repo);
                
                displayMenus();
                
                const totalMenus = menus1.length + menus2.length;
                document.getElementById('status').textContent = `Found ${totalMenus} MP4 files. Click any card to select, then upload a replacement.`;
                
                // Show debugging info in console
                console.log('Final results:', {
                    repo: repo,
                    folder1: menus1.length + ' files in "1 monitors"',
                    folder2: menus2.length + ' files in "2 monitors"',
                    total: totalMenus
                });
                
            } catch (error) {
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        <h3>❌ Could not load menus</h3>
                        <p>${error.message}</p>
                        <small>Make sure the repository "${repo}" exists and has "1 monitors" and "2 monitors" folders with .mp4 files</small>
                    </div>
                `;
                document.getElementById('status').textContent = 'Error loading menu files';
            }
        }

        async function loadMenusFromFolder(folderName, repo) {
            try {
                const url = `https://api.github.com/repos/${username}/${repo}/contents/${encodeURIComponent(folderName)}`;
                console.log(`Checking folder: ${folderName} at ${url}`);
                
                const headers = {};
                if (githubToken) {
                    headers['Authorization'] = `token ${githubToken}`;
                }
                
                const response = await fetch(url, { headers });
                
                if (!response.ok) {
                    console.log(`Folder "${folderName}" not found - Status: ${response.status}`);
                    return [];
                }
                
                const contents = await response.json();
                console.log(`Found ${contents.length} items in "${folderName}":`, contents.map(item => item.name));
                
                // Find ALL .mp4 files in the folder
                const mp4Files = contents.filter(item => 
                    item.type === 'file' && 
                    item.name.toLowerCase().endsWith('.mp4')
                ).map(item => ({
                    name: item.name,
                    path: item.path,
                    download_url: item.download_url,
                    size: item.size,
                    sha: item.sha // Include SHA for deletion
                }));
                
                console.log(`MP4 files in "${folderName}":`, mp4Files.map(item => item.name));
                return mp4Files;
                
            } catch (error) {
                console.log(`Error loading from "${folderName}":`, error);
                return [];
            }
        }

        function displayMenus() {
            let html = '';
            
            if (menus1.length > 0) {
                html += `
                    <div class="folder-section">
                        <div class="folder-title">📺 Single Monitor Menus (${menus1.length})</div>
                        <div class="grid">
                            ${menus1.map((menu, index) => `
                                <div class="menu-card monitors-1" id="card-${menu.path}" onclick="selectFile('${menu.path}', '${menu.name}', '1 monitors')">
                                    <button class="delete-btn" onclick="event.stopPropagation(); deleteFile('${menu.path}', '${menu.sha}', '${menu.name}')" title="Delete file">🗑️</button>
                                    <div class="folder-badge">1 Monitor</div>
                                    
                                    <div class="video-thumbnail">
                                        <video preload="metadata" muted>
                                            <source src="${menu.download_url}#t=1" type="video/mp4">
                                        </video>
                                        <div class="video-overlay">
                                            <div class="thumbnail-play-icon" onclick="event.stopPropagation(); playMenu('${menu.download_url}', '${menu.name}')">▶️</div>
                                        </div>
                                    </div>
                                    
                                    <div class="video-content">
                                        <div class="menu-name">${menu.name}</div>
                                        <div class="menu-info">${(menu.size / (1024*1024)).toFixed(1)} MB</div>
                                    </div>
                                    
                                    <div class="select-indicator">SELECTED</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            if (menus2.length > 0) {
                html += `
                    <div class="folder-section">
                        <div class="folder-title">📺📺 Dual Monitor Menus (${menus2.length})</div>
                        <div class="grid">
                            ${menus2.map((menu, index) => `
                                <div class="menu-card monitors-2" id="card-${menu.path}" onclick="selectFile('${menu.path}', '${menu.name}', '2 monitors')">
                                    <button class="delete-btn" onclick="event.stopPropagation(); deleteFile('${menu.path}', '${menu.sha}', '${menu.name}')" title="Delete file">🗑️</button>
                                    <div class="folder-badge">2 Monitors</div>
                                    
                                    <div class="video-thumbnail">
                                        <video preload="metadata" muted>
                                            <source src="${menu.download_url}#t=1" type="video/mp4">
                                        </video>
                                        <div class="video-overlay">
                                            <div class="thumbnail-play-icon" onclick="event.stopPropagation(); playMenu('${menu.download_url}', '${menu.name}')">▶️</div>
                                        </div>
                                    </div>
                                    
                                    <div class="video-content">
                                        <div class="menu-name">${menu.name}</div>
                                        <div class="menu-info">${(menu.size / (1024*1024)).toFixed(1)} MB</div>
                                    </div>
                                    
                                    <div class="select-indicator">SELECTED</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            if (menus1.length === 0 && menus2.length === 0) {
                html = `
                    <div class="loading">
                        <h3>📁 No .mp4 files found</h3>
                        <p>Looking for .mp4 files in folders:</p>
                        <p>📂 "1 monitors" and 📂 "2 monitors"</p>
                        <p>Repository: ${repoName}</p>
                    </div>
                `;
            }
            
            document.getElementById('content').innerHTML = html;
        }

        function playMenu(videoUrl, menuName) {
            const video = document.getElementById('fullscreenVideo');
            video.src = videoUrl;
            document.getElementById('fullscreen').classList.add('show');
            video.play();
        }

        function closeVideo() {
            document.getElementById('fullscreen').classList.remove('show');
            document.getElementById('fullscreenVideo').pause();
        }

        // Auto-load when page opens
        window.onload = function() {
            // Automatically start loading menus
            loadMenus();
            clearSelection(); // Ensure no file is selected initially
        }

        // Close video with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeVideo();
                closeUploadModal();
            }
        });

        // File Upload Functions
        function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;
            
            if (!selectedFile) {
                alert('Please select a file to replace first');
                return;
            }
            
            if (files.length > 1) {
                alert('Please select only one file for replacement');
                return;
            }
            
            const newFile = files[0];
            
            // Update modal with replacement info
            document.getElementById('originalFileName').textContent = selectedFile.name;
            document.getElementById('originalLocation').textContent = selectedFile.folder;
            document.getElementById('newFileName').textContent = newFile.name;
            
            selectedFiles = [newFile];
            
            // Show upload modal
            document.getElementById('uploadOverlay').classList.add('show');
        }

        function closeUploadModal() {
            document.getElementById('uploadOverlay').classList.remove('show');
            document.getElementById('fileInput').value = '';
            selectedFiles = [];
            resetUploadProgress();
        }

        function resetUploadProgress() {
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('uploadButtons').style.display = 'block';
            document.getElementById('progressFill').style.width = '0%';
        }

        async function startReplacement() {
            if (selectedFiles.length === 0 || !selectedFile) return;
            
            const newFile = selectedFiles[0];
            const progressBar = document.getElementById('progressFill');
            const statusText = document.getElementById('uploadStatus');
            
            document.getElementById('uploadProgress').style.display = 'block';
            document.getElementById('uploadButtons').style.display = 'none';
            
            try {
                statusText.textContent = `Replacing ${selectedFile.name} with ${newFile.name}...`;
                progressBar.style.width = '20%';
                
                // Convert file to base64
                const base64Content = await fileToBase64(newFile);
                progressBar.style.width = '60%';
                
                // Get the current file info to get the SHA for replacement
                statusText.textContent = 'Getting file information...';
                const currentFileInfo = await getCurrentFileInfo(selectedFile.path);
                progressBar.style.width = '80%';
                
                // Upload replacement file
                statusText.textContent = 'Uploading replacement...';
                await replaceFileOnGitHub(selectedFile.path, base64Content, newFile.name, currentFileInfo.sha);
                progressBar.style.width = '100%';
                
                statusText.textContent = `✅ Successfully replaced ${selectedFile.name}!`;
                
                setTimeout(() => {
                    closeUploadModal();
                    clearSelection();
                    loadMenus(); // Refresh the display
                }, 2000);
                
            } catch (error) {
                alert(`Failed to replace file: ${error.message}`);
                resetUploadProgress();
            }
        }

        async function getCurrentFileInfo(filePath) {
            const url = `https://api.github.com/repos/${username}/${repoName}/contents/${filePath}`;
            const headers = {};
            if (githubToken) {
                headers['Authorization'] = `token ${githubToken}`;
            }
            
            const response = await fetch(url, { headers });
            if (!response.ok) {
                throw new Error(`Could not get file info: ${response.status}`);
            }
            
            return await response.json();
        }

        async function replaceFileOnGitHub(filePath, base64Content, newFileName, currentSha) {
            const url = `https://api.github.com/repos/${username}/${repoName}/contents/${filePath}`;
            
            const response = await fetch(url, {
                method: 'PUT',
                headers: getHeaders(),
                body: JSON.stringify({
                    message: `Replace ${filePath.split('/').pop()} with ${newFileName}`,
                    content: base64Content,
                    sha: currentSha // Required for updating existing files
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || `Upload failed: ${response.status}`);
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    // Remove the data:video/mp4;base64, prefix
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = error => reject(error);
            });
        }

        // File Delete Functions
        async function deleteFile(filePath, fileSha, fileName) {
            if (!confirm(`Are you sure you want to delete "${fileName}"?`)) {
                return;
            }
            
            try {
                const url = `https://api.github.com/repos/${username}/${repoName}/contents/${filePath}`;
                
                const response = await fetch(url, {
                    method: 'DELETE',
                    headers: getHeaders(),
                    body: JSON.stringify({
                        message: `Delete ${fileName}`,
                        sha: fileSha
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || `Delete failed: ${response.status}`);
                }
                
                // Refresh the display
                loadMenus();
                alert(`✅ Successfully deleted "${fileName}"`);
                
            } catch (error) {
                alert(`❌ Failed to delete "${fileName}": ${error.message}`);
            }
        }
    </script>
</body>
</html>
